import requests
import json as JSON
import urllib

class sentiment:
    def __init__(self, token, lang):
        self.lang = lang
        self.token = token

    def talk(self, sentence):
        ret = self.__query(self.lang, sentence)
        return ret


    def __query(self, lang, query):
        url = "http://dialogflow_sentiment_api:8080/sentence/"
        headers = {
                'Content-Type': "application/json",
                'cache-control': "no-cache",
                }
        data = {
        	"token": self.token,
        	"sentence": query,
        	"lang": lang
        }
        payload = JSON.dumps(data)
        try:
            res = requests.request("POST", url, data=payload, headers=headers)
            if res.status_code != 200:
                return [False, "invalid token ", 401]
            return [True, JSON.loads(res.text)["data"], None]
        except:
            return [True, {"info": "'dialogflow_sentiment_api' isn't connected" }, None]
